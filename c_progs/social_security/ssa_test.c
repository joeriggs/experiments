/*******************************************************************************
 * This file contains the test code/data for the Social Security app.
 ******************************************************************************/

#include <stdio.h>

#include "ssa.h"
#include "ssa_test.h"

/* Test data, taken from:
 *   https://www.ssa.gov/oact/ProgData/retirebenefit1.html
 */
typedef struct test_data {
  int    year;
  int    nominal_earnings;
  float  indexing_factor;
  int    indexed_earnings;
} test_data;
/*
 *              Nominal      Indexing      Indexed
 *   Year      earnings        factor     earnings
 */
test_data test1[] = {
  {  1976,         8627,       5.0378,       43461 },
  {  1977,         9173,       4.7530,       43599 },
  {  1978,         9932,       4.4033,       43734 },
  {  1979,        10835,       4.0491,       43872 },
  {  1980,        11848,       3.7145,       44010 },
  {  1981,        13081,       3.3748,       44146 },
  {  1982,        13844,       3.1987,       44283 },
  {  1983,        14563,       3.0501,       44419 },
  {  1984,        15467,       2.8808,       44557 },
  {  1985,        16175,       2.7631,       44692 },
  {  1986,        16707,       2.6834,       44832 },
  {  1987,        17826,       2.5225,       44967 },
  {  1988,        18761,       2.4041,       45104 },
  {  1989,        19564,       2.3126,       45243 },
  {  1990,        20529,       2.2105,       45379 },
  {  1991,        21359,       2.1310,       45517 },
  {  1992,        22527,       2.0266,       45654 },
  {  1993,        22789,       2.0093,       45791 },
  {  1994,        23470,       1.9568,       45927 },
  {  1995,        24484,       1.8814,       46064 },
  {  1996,        25758,       1.7937,       46202 },
  {  1997,        27342,       1.6948,       46339 },
  {  1998,        28858,       1.6105,       46476 },
  {  1999,        30556,       1.5255,       46613 },
  {  2000,        32340,       1.4456,       46749 },
  {  2001,        33209,       1.4119,       46887 },
  {  2002,        33640,       1.3979,       47024 },
  {  2003,        34563,       1.3645,       47161 },
  {  2004,        36275,       1.3039,       47298 },
  {  2005,        37711,       1.2579,       47435 },
  {  2006,        39558,       1.2026,       47572 },
  {  2007,        41473,       1.1504,       47710 },
  {  2008,        42549,       1.1245,       47847 },
  {  2009,        42027,       1.1417,       47983 },
  {  2010,        43143,       1.1154,       48120 },
  {  2011,        44622,       1.0815,       48258 },
  {  2012,        46146,       1.0487,       48395 },
  {  2013,        46868,       1.0355,       48532 },
  {  2014,        48669,       1.0000,       48669 },
  {  2015,        50211,       1.0000,       50211 },
  {     0,            0,            0,           0 }
};
int test1_dob        =    1954;

int test1_highest_35 = 1628054;
int test1_AIME       =    3876;

/*
 *              Nominal      Indexing      Indexed
 *   Year      earnings        factor     earnings
 */
test_data test2[] = {
  {  1976,        15300,       4.5168,       69106 },
  {  1977,        16500,       4.2614,       70313 },
  {  1978,        17700,       3.9479,       69877 },
  {  1979,        22900,       3.6303,       83134 },
  {  1980,        25900,       3.3303,       86255 },
  {  1981,        29700,       3.0257,       89864 },
  {  1982,        32400,       2.8679,       92919 },
  {  1983,        35700,       2.7346,       97627 },
  {  1984,        37800,       2.5828,       97630 },
  {  1985,        39600,       2.4773,       98100 },
  {  1986,        42000,       2.4059,      101046 },
  {  1987,        43800,       2.2616,       99059 },
  {  1988,        45000,       2.1555,       96996 },
  {  1989,        48000,       2.0734,       99522 },
  {  1990,        51300,       1.9818,      101668 },
  {  1991,        53400,       1.9106,      102027 },
  {  1992,        55500,       1.8170,      100844 },
  {  1993,        57600,       1.8015,      103767 },
  {  1994,        60600,       1.7544,      106318 },
  {  1995,        61200,       1.6868,      103233 },
  {  1996,        62700,       1.6082,      100832 },
  {  1997,        65400,       1.5195,       99375 },
  {  1998,        68400,       1.4439,       98765 },
  {  1999,        72600,       1.3677,       99296 },
  {  2000,        76200,       1.2960,       98758 },
  {  2001,        80400,       1.2658,      101773 },
  {  2002,        84900,       1.2533,      106403 },
  {  2003,        87000,       1.2234,      106433 },
  {  2004,        87900,       1.1690,      102757 },
  {  2005,        90000,       1.1278,      101498 },
  {  2006,        94200,       1.0782,      101566 },
  {  2007,        97500,       1.0314,      100561 },
  {  2008,       102000,       1.0082,      102836 },
  {  2009,       106800,       1.0236,      109324 },
  {  2010,       106800,       1.0000,      106800 },
  {  2011,       106800,       1.0000,      106800 },
  {  2012,       110100,       1.0000,      110100 },
  {  2013,       113700,       1.0000,      113700 },
  {  2014,       117000,       1.0000,      117000 },
  {  2015,       118500,       1.0000,      118500 },
  {     0,            0,            0,           0 }
};
int test2_dob        =    1950;

int test2_highest_35 = 3593696;
int test2_AIME       =    8556;


static int run_test_data(test_data *data,
                         int        dob,
                         int        highest_35,
                         int        AIME)
{
  int retcode = 0;

  ssa_init();

  while(data->year != 0) {
    test_data *d = data++;
    ssa_add_wage(dob, d->year, d->nominal_earnings);
  }

  int PIA;
  ssa_calc_benefit(dob, &PIA);
  printf("PIA = %d\n", PIA);

  return retcode;
}

int ssa_test(void)
{
  int retcode = 0;

  float indexing_factor;

  /* Test: Result = 5.037838 */
  indexing_factor = calc_indexing_factor(1954, 1976);
  printf("Test 1 = %f\n", indexing_factor);

  /* Test: Result = 4.516763 */
  indexing_factor = calc_indexing_factor(1950, 1976);
  printf("Test 2 = %f\n", indexing_factor);

  retcode = run_test_data(test1, test1_dob, test1_highest_35, test1_AIME);

  retcode = run_test_data(test2, test2_dob, test2_highest_35, test2_AIME);

  return retcode;
}

